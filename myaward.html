<!DOCTYPE html>

<head>
    <title>FindSell HomePage2</title>
    <style></style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="stylesheet" href="css.css">
   <link rel="stylesheet" href="style.css">
   <link rel="stylesheet" href="css.css">
   <link rel="stylesheet" href="style.css">
   <link rel="stylesheet" href="style2.css">
   <link rel="stylesheet" href="my.css">
   <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <header>
        <div class="head">
            <a href="http://127.0.0.1:5500/index2.html"><img class="logo" src="Selling_transparent-.png" alt="Find Sell"></a>
            <input type="text" class="search" style="width:35vw">
            <button class="bt">Search</button>
         
            <section class="dropd" style="width:20vw">Welcome! <span id="usrem"></span>
                <section class="dropdown" >
                    <a href='http://127.0.0.1:5500/myaccount.html'>My Account <div class="tag"></div></a>
                    <div class="tag"><a href='http://127.0.0.1:5500/myproduct.html'>My Products</a></div>
                    <div class="tag"><a href='http://127.0.0.1:5500/myfriend.html'>My Friends</a></div>
                    <div class="tag"><a href='http://127.0.0.1:5500/myaward.html'>Awards</a></div>
                </section>
            </section>
            
            <a href='http://127.0.0.1:5500/product.html'><div class="set" style="width:7vw; margin-left:3vw;"><button class="inbt">Sell</button></div></a>
        </div>
    </header>
    <script>
        let usrmail = localStorage.getItem("usremail");
        let passwd = localStorage.getItem("usrpasswd");
        let idnum = localStorage.getItem("usrid");
        document.getElementById("usrem").innerHTML= usrmail;
    </script>
  <div>&nbsp &nbsp &nbsp &nbsp</div>
<script>
    const dropd = document.querySelector('.dropd');
    const dropdown = document.querySelector('.dropdown');

    function toggleDropdown() {
        if (dropdown.style.display === 'block') {
            dropdown.style.display = 'none';
        } else {
            dropdown.style.display = 'block';
        }
    }

    dropd.addEventListener('click', function(event) {
        event.stopPropagation();
        toggleDropdown();
    });

    document.addEventListener('click', function(event) {
        if (!dropdown.contains(event.target)) {
            dropdown.style.display = 'none';
        }
    });

    dropdown.addEventListener('click', function(event) {
        event.stopPropagation();
    });
</script>

<div>&nbsp &nbsp &nbsp &nbsp</div>
<div class="product-panel" style="margin-top:12vw">
    <div class="product-header">
        <h1>My Reward</h1>
        <div class="product-controls">
            <section>Number of Voucher: <span id="voucher"></span></section>
        </div>
    </div>
    <div class="product-content" id="product-content" style="justify-content:start;gap:1vw"></div>
<script>
    const productContent = document.getElementById("product-content");
    const APIKEY = "678fa7439bd0c87432ac8bee";
    const set = {
        method: "GET",
        headers: {
            "Content-Type": "application/json",
            "x-apikey": APIKEY,
            "Cache-Control": "no-cache",
        },
    };

    async function loadRewards() {
        try {
            const response = await fetch("https://jackm-ff5c.restdb.io/rest/award", set);
            const data = await response.json();
            console.log("Data: " + JSON.stringify(data));
            productContent.innerHTML = '';

            if (data.length === 0) {
                productContent.innerHTML = "<p>No Reward available.</p>";
                return;
            }

            data.forEach(reward => {
                if (reward.usrid === localStorage.getItem("usrid")) {
                    const rewardItem = document.createElement("div");
                    rewardItem.className = "reward-item";
                    rewardItem.dataset.id = reward._id;
                    rewardItem.innerHTML = `
                        <section style="width:20%;height:20vw">
                            <img class="voucher-icon" style='width:40vw;height:20vw'src="dca71ba1-6f4a-4baa-87bc-6024b801fd0c.jpg" alt="Voucher" style="cursor: pointer;" />
                        </section>
                        <div class="reward-info">
                            <h3 class="name">${reward.type || 'Unnamed Reward'}</h3>
                            <p class="reward-number">Voucher Number: ${reward.number || 0}</p>
                        </div>
                    `;

                    rewardItem.querySelector(".voucher-icon").addEventListener("click", function() {
                        localStorage.setItem("reward-id", reward._id);
                        window.location.href = 'http://127.0.0.1:5500/product.html';
                    });

                    productContent.appendChild(rewardItem);
                }
            });
        } catch (error) {
            console.error("Failed to load rewards:", error);
        }
    }

    loadRewards();
</script>
</body>
