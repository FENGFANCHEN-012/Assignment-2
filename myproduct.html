<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log in/Sign up</title>
    <link rel="stylesheet" href="combined_style.css">
    <style>
        body {
            padding-top: 70px; /* Adjust this value based on the actual height of your header */
        }
        header {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000; /* Keeps the header on top */
            background-color: #fff; /* Background color of the header */
            border-bottom: 1px solid #ccc; /* Adds a subtle line under the header */
        }
        .dropdown {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
        }
        .dropdown a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }
        .dropdown a:hover {background-color: #f1f1f1}
    </style>
</head>
<body>
    <header>
        <div class="head">
            <a href="index.html"><img class="logo" src="Selling_transparent-.png" alt="Find Sell"></a>
            <input type="text" class="search" style="width:35vw">
            <button class="bt">Search</button>
            <section class="dropd" style="width:20vw">Welcome! <span id="usrem"></span>
                <div class="dropdown">
                    <a href='myaccount.html'>My Account</a>
                    <a href='myproduct.html'>My Products</a>
                    <a href='myfriend.html'>My Friends</a>
                    <a href='myaward.html'>Awards</a>
                </div>
            </section>
            <a href='product.html'><div class="set" style="width:7vw; margin-left:3vw;"><button class="inbt">Sell</button></div></a>
        </div>
    </header>
    <script>
        let usrmail = localStorage.getItem("usremail");
        document.getElementById("usrem").innerHTML = usrmail;
        const dropdown = document.querySelector('.dropdown');
        document.querySelector('.dropd').addEventListener('click', function(event) {
            event.stopPropagation();
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        });
        window.addEventListener('click', function() {
            if (dropdown.style.display === 'block') {
                dropdown.style.display = 'none';
            }
        });
    </script>
    <div class="product-panel" style="margin-top:12vw">
        <div class="product-header">
            <h1>My Products</h1>
            <div class="product-controls">
                <a href="product.html"><button class="btn" id="edit-products">Add Product</button></a>
                <input type="text" placeholder="Searching~~" class="product-search">
            </div>
        </div>
        <div class="product-content" id="product-content"></div>
    </div>
    <script>
        const APIKEY = "67971683f9d2bb616f181e2b";
        async function loadProducts() {
            const response = await fetch("https://assignmentfed-fb7a.restdb.io/rest/product", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "x-apikey": APIKEY,
                    "Cache-Control": "no-cache",
                },
            });
            const data = await response.json();
            const productContent = document.getElementById("product-content");
            productContent.innerHTML = '';
            if (data.length === 0) {
                productContent.innerHTML = "<p>No products available.</p>";
                return;
            }
            data.forEach(product => {
                const productItem = document.createElement("div");
                productItem.className = "product-item";
                productItem.dataset.id = product._id;
                const productImage = document.createElement("img");
                productImage.src = product.url;
                productImage.alt = "Product Image";
                productImage.className = "product-image";
                productItem.appendChild(productImage);
                const productInfo = document.createElement("div");
                productInfo.className = "product-info";
                productInfo.innerHTML = `
                    <h3 class="name">${product.name || 'Unnamed Product'}</h3>
                    <p class="product-price">Price: ¥${product.price || 0}</p>
                    <p class="product-reviews">Comment: ${product.comments || 'No comments'}</p>
                    <button class="delete-btn" data-id="${product._id}">Delete</button>
                `;
                productItem.appendChild(productInfo);
                productContent.appendChild(productItem);
            });
        }
        loadProducts();
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const APIKEY = "67971683f9d2bb616f181e2b";
            async function loadProducts() {
                const response = await fetch("https://assignmentfed-fb7a.restdb.io/rest/product", {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                        "x-apikey": APIKEY,
                        "Cache-Control": "no-cache",
                    },
                });
                const data = await response.json();
                const productContent = document.getElementById("product-content");
                productContent.innerHTML = '';
                if (data.length === 0) {
                    productContent.innerHTML = "<p>No products available.</p>";
                    return;
                }
                data.forEach(product => {
                    const productItem = document.createElement("div");
                    productItem.className = "product-item";
                    productItem.dataset.id = product._id;
                    const productImage = document.createElement("img");
                    productImage.src = product.url;
                    productImage.alt = "Product Image";
                    productImage.className = "product-image";
                    productItem.appendChild(productImage);
                    const productInfo = document.createElement("div");
                    productInfo.className = "product-info";
                    productInfo.innerHTML = `
                        <h3 class="name">${product.name || 'Unnamed Product'}</h3>
                        <p class="product-price">Price: ¥${product.price || 0}</p>
                        <p class="product-reviews">Comment: ${product.comments || 'No comments'}</p>
                        <button class="delete-btn" data-id="${product._id}">Delete</button>
                    `;
                    productItem.appendChild(productInfo);
                    productContent.appendChild(productItem);
                });
            }
            loadProducts();
        
            document.addEventListener('click', function(event) {
                const target = event.target;
                if (target.classList.contains('delete-btn')) {
                    const productId = target.dataset.id;
                    if (confirm('Are you sure you want to delete this product?')) {
                        fetch(`https://assignmentfed-fb7a.restdb.io/rest/product/${productId}`, {
                            method: 'DELETE',
                            headers: {
                                'Content-Type': 'application/json',
                                'x-apikey': APIKEY
                            }
                        })
                        .then(response => {
                            if (response.ok) {
                                alert('Product deleted successfully');
                                target.closest('.product-item').remove();
                            } else {
                                response.text().then(text => alert('Failed to delete the product: ' + text));
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('An error occurred while deleting the product');
                        });
                    }
                }
            });
        });
        </script>
        
</body>
</html>
