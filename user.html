<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FindSell HomePage2</title>
    <link rel="stylesheet" href="css.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="my.css">
    <style>
        .product-image{
         width:50vw;
         height:40vw;
         background-position: center;
        }
         .product-page {
             font-family: Arial, sans-serif;
             color: #333;
             line-height: 1.6;
             max-width: 1200px;
             margin: 0 auto;
             padding: 20px;
         }
 
         .product-header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             border-bottom: 2px solid #f0f0f0;
             padding-bottom: 10px;
         }
 
         .product-header h1 {
             font-size: 24px;
             font-weight: bold;
             color: #007BFF;
         }
 
         .product-main {
             display: flex;
             gap: 20px;
             margin-top: 20px;
         }
 
         .product-image-section {
             flex: 2;
         }
 
         .product-image {
             width: 100%;
             height: auto;
             border-radius: 8px;
             box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
         }
 
         .product-thumbnails {
             display: flex;
             gap: 10px;
             margin-top: 10px;
         }
 
         .product-thumbnails img {
             width: 60px;
             height: 60px;
             border: 2px solid #ddd;
             border-radius: 4px;
             cursor: pointer;
         }
 
         .product-thumbnails img:hover {
             border-color: #007BFF;
         }
 
         .product-details {
             flex: 3;
             display: flex;
             flex-direction: column;
             justify-content: space-between;
         }
 
         .product-price {
             font-size: 28px;
             font-weight: bold;
             color: #E74C3C;
             margin: 10px 0;
         }
 
         .btn-buy {
             padding: 12px 20px;
             background-color: #4CAF50;
             color: #fff;
             border: none;
             border-radius: 4px;
             font-size: 16px;
             cursor: pointer;
             margin-top: 20px;
         }
 
         .btn-buy:hover {
             background-color: #45a049;
         }
 
         .product-description {
             margin-top: 20px;
             border-top: 1px solid #f0f0f0;
             padding-top: 10px;
         }
 
         .product-reviews {
             margin-top: 40px;
         }
 
         .review-item {
             border-bottom: 1px solid #f0f0f0;
             padding: 10px 0;
         }
 
         .comment-box {
             margin-top: 20px;
         }
 
         .comment-input {
             width: 100%;
             padding: 10px;
             margin: 10px 0;
             border: 1px solid #ddd;
             border-radius: 4px;
             font-size: 14px;
         }
 
         .btn-publish {
             background-color: #007BFF;
             color: white;
             padding: 10px 20px;
             border: none;
             border-radius: 4px;
             cursor: pointer;
         }
 
         .btn-publish:hover {
             background-color: #0056b3;
         }
 
         .footer {
             text-align: center;
             padding: 20px;
             background-color: #f9f9f9;
             margin-top: 40px;
         }
     </style>
    <style>
        .product-item {
            width: 85%;
        }

        #img {
            height: 10vw;
            width: 10vw;
            display: flex;
            margin-right: 20vw;
            justify-content: center;
        }

        .show {
            display: none;
        }
    </style>
</head>

<body>
    <script>
          
        document.addEventListener('DOMContentLoaded', async () => {
            if (!userId) {
                document.getElementById('message').textContent = 'Please log in before checking in.';
                document.getElementById('signInButton').disabled = true;
                return;
            }})
    </script>
    <header>
        <div class="head">
            <a href="http://127.0.0.1:5500/index2.html"><img class="logo" src="Selling_transparent-.png" alt="Find Sell"></a>
            <input type="text" class="search" style="width:35vw">
            <button class="bt">Search</button>

            <section class="dropd" style="width:20vw">Welcome! <span id="usrem"></span>
                <section class="dropdown">
                    <a href='http://127.0.0.1:5500/myaccount.html'>My Account <div class="tag"></div></a>
                    <div class="tag"><a href='http://127.0.0.1:5500/myproduct.html'>My Products</a></div>
                    <div class="tag"><a href='http://127.0.0.1:5500/myfriend.html'>My Friends</a></div>
                    <div class="tag"><a href='http://127.0.0.1:5500/myaward.html'>Awards</a></div>
                </section>
            </section>

            <a href='http://127.0.0.1:5500/product.html'><div class="set" style="width:7vw; margin-left:3vw;"><button class="inbt">Sell</button></div></a>
        </div>
    </header>
    <script>
        const dropd = document.getElementsByClassName('dropd');
        const dropdown = document.getElementsByClassName('dropdown');
    
        
        function toggleDropdown() {
            if (dropdown[0].style.display === 'block') {
                dropdown[0].style.display = 'none';
            } else {
                dropdown[0].style.display = 'block';
            }
        }
    
        dropd[0].addEventListener('click', function(event) {
            event.stopPropagation();
            toggleDropdown();
        });
    
        document.addEventListener('click', function(event) {
            if (!dropdown[0].contains(event.target)) {
                dropdown[0].style.display = 'none';
            }
        });
    
        dropdown[0].addEventListener('click', function(event) {
            event.stopPropagation();
        });
    
    
    
    </script>
    <script>
        let others = localStorage.getItem("selectedUser")
        let other = JSON.parse(others)
        let userId=  localStorage.getItem("usrid")
        let usrmail = localStorage.getItem("usremail");
        document.getElementById("usrem").innerHTML = usrmail;
    </script>
    <div >                                     &nbsp  &nbsp  &nbsp  &nbsp</div>
    <div class="main" style='margin-top:10vw;height:85vw;align-items:start'>
        <div class="product-panel">
            <div class="product-header">
                <h1 id="u-n">User</h1>
            </div>

            <div class="product-content" style="align-items: center;justify-content:center;width:100%">
                <img id="img" src="" >
                <input class="show" type="file" id="img2" accept="image/*" />

                <div class="product-item" id='info' style="margin-bottom: 20px;">
                   
                    <p><strong>Name:</strong> <span class="sub" id="name-display"></span></p>
                    <input type="text" class="show" id="name" placeholder="What is your Name?">
                    <p><strong>Email:</strong> <span class="sub" id="email-display"></span></p>
                    <p><strong>Account Bio:</strong> <span class="sub" id="bio-display"></span></p>
                    <textarea class="show" id="bio" placeholder="Input your Description"></textarea>
                </div>

                <div class="product-item" style="margin-bottom: 20px;">
                    <h3>Recent Activity</h3>
                    <p>No recent activity.</p>
                </div>
                <div class="product-item"  style="margin-bottom: 20px;">
                    <h3>Product:</h3>
                    <section id="u-p"></section>
                </div>
                <div class="product-item"  style="margin-bottom: 20px;">
                    <h3>Comment</h3>
                    
                    <section class="product-reviews">
                        <h2>User Reviews</h2>
                        <section id="comment">
            
                        </section>
                        <div id="reviews-container"></div>
                        <div class="comment-box">
                            <textarea id="comment-input" class="comment-input" placeholder="Write your comment here..."></textarea>
                            <button id="publish-btn" class="btn-publish">Publish</button>
                        </div>
                    </section>
                </div>

          
        </div>
    </div>

    <div class="footer">
        <p>&copy; 2025 My Company. All rights reserved.</p>
    </div>
     
    <script>
        function base64ToUrl(base64) {
          
            const byteCharacters = atob(base64.split(',')[1]); 
            const byteArrays = [];
        
            for (let offset = 0; offset < byteCharacters.length; offset++) {
                byteArrays.push(byteCharacters.charCodeAt(offset));
            }
        
            
            const blob = new Blob([new Uint8Array(byteArrays)], { type: 'image/png' });
        
           
            return URL.createObjectURL(blob);
        }
        const imageUrl = base64ToUrl(other.otheravatar);
        document.getElementById("img").src=imageUrl
        document.getElementById("name-display").innerText = other.othername
        document.getElementById("email-display").innerText = other.otheremail
        document.getElementById("bio-display").innerText = other.otherbio
        account = "https://jackm-ff5c.restdb.io/rest/account"
        testurl   = "https://assignmentfed-fb7a.restdb.io/rest/account"
        api = "678fa7439bd0c87432ac8bee"
         test = "67971683f9d2bb616f181e2b"
      
      
        const producturl =  "https://assignmentfed-fb7a.restdb.io/rest/product";
      
        async function loaduser(){

        }
        
        async function loadProducts() {
            try {
                let user_now = localStorage.getItem("user_now")
                const set = {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                        "x-apikey":api,
                        "Cache-Control": "no-cache",
                    },
                }
                document.getElementById("u-p").innerHTML='';
                const response = await fetch(`${producturl}`, set);
                const data = await response.json();
               
                console.log("Data: " + JSON.stringify(data))
               if(data.length===0){
                document.getElementById("u-p").innerHTML='This User Has No Product'
               }
                data.forEach(product => {
                    if(product.id===user_now){
                    const productItem = document.createElement("div");
                    productItem.className = "product-item";
                    productItem.dataset.id = product._id; 
                    const base64Data = `${product.url}`; 
                    const contentType = "image/png"; 
                    
                   
                    function base64ToBlob(base64, contentType) {
                        const byteCharacters = atob(base64);
                        const byteArrays = [];
                        for (let offset = 0; offset < byteCharacters.length; offset += 512) {
                            const slice = byteCharacters.slice(offset, offset + 512);
                            const byteNumbers = new Array(slice.length);
                            for (let i = 0; i < slice.length; i++) {
                                byteNumbers[i] = slice.charCodeAt(i);
                            }
                            byteArrays.push(new Uint8Array(byteNumbers));
                        }
                        return new Blob(byteArrays, { type: contentType });
                    }
                    
                    
                    const blob = base64ToBlob(base64Data, contentType);
                    const blobUrl = URL.createObjectURL(blob);
                    
                    
                  
                    productItem.innerHTML = `
                       <section style="width:100%;height:20vw" >
                        <img  data-pid=${product.productID} data-usrid=${localStorage.getItem('usrid')} data-price='${product.price}' data-tag='${product.tag}' data-des ='${product.Description}' data-brand='${product.Brand}' data-url='${blobUrl}' data-name='${product.name}' src=${blobUrl} alt="Product Image" class="product-image" style="backrgound-size:cover;background-position:center">
                       </section>
                        <div class="product-info">
                            <h3 class="name">${product.name || 'Unnamed Product'}</h3>
                            <p class="product-price">Price: Â¥${product.price || 0}</p>
                            <p class="product-reviews">Comment: ${product.comments || 'No comments'}</p>
                            <button class="delete-btn" data-id="${product._id}">Delete</button>
                        </div>
                    `;
                     console.log(localStorage.getItem("userid"));
                   
                     document.getElementById("u-p").appendChild(productItem);
                    
            }})
              
            } catch (error) {
                console.error("Failed to load products:", error);
            }
        }
        document.getElementById("publish-btn").addEventListener("click", async function() {
            const commentInput = document.getElementById("comment-input");
            const comment = commentInput.value.trim();
        
            if (!comment) {
                alert("Please enter a comment before submitting.");
                return;
            }
        
            const productId = document.querySelector(".product-item").dataset.id;  
            const userId = localStorage.getItem("usrid");  
        
            const newComment = {
                userId: userId,
                productId: productId,
                comment: comment,
            };
        
            const response = await fetch("https://jackm-ff5c.restdb.io/rest/comments", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "x-apikey": api,
                    "Cache-Control": "no-cache",
                },
                body: JSON.stringify(newComment),
            });
        
            if (response.ok) {
                alert("Comment posted!");
                commentInput.value = ""; 
                loadComments(productId);  
            } else {
                alert("Failed to post comment. Please try again.");
            }
        });
        loadProducts();
      
        const set = {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
                "x-apikey": api,
                "Cache-Control": "no-cache",
            },
        };

        fetch("https://jackm-ff5c.restdb.io/rest/account", set)
            .then((response) => response.json())
            .then((data) => {
                const userEmail = localStorage.getItem("usremail");
                const user = data.find((w) => w.email === userEmail);
                 





                // get image file base64 link
            const imgFile = document.getElementById('img2').files[0];
            const base64Data = `${user.avatar}`; 
            const contentType = "image/png"; 
            function base64ToBlob(base64, contentType = "") {
                const byteCharacters = atob(base64)
                const byteArrays = [];
            
                for (let offset = 0; offset < byteCharacters.length; offset += 512) {
                    const slice = byteCharacters.slice(offset, offset + 512);
            
                    const byteNumbers = new Array(slice.length);
                    for (let i = 0; i < slice.length; i++) {
                        byteNumbers[i] = slice.charCodeAt(i);
                    }
            
                    const byteArray = new Uint8Array(byteNumbers);
                    byteArrays.push(byteArray);
                }
            
                return new Blob(byteArrays, { type: contentType });
            }




            const avatarBase64 = user.avatar ; //get the data of file image link
            if (avatarBase64.startsWith("data:image")) {
                const base64Data = avatarBase64.split(",")[1]; 
                const blob = base64ToBlob(base64Data, "image/png");
                const blobUrl = URL.createObjectURL(blob);
                document.getElementById('img').src = blobUrl;
            }
             




                localStorage.setItem("change", user._id);

                
                document.getElementById('name-display').textContent = user.name || "Nil";
                document.getElementById('email-display').textContent = user.email;
                document.getElementById('bio-display').textContent = user.bio || "Nil";
            });

     
    </script>
</body>

</html>
